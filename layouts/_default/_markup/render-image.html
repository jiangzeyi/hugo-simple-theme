{{- $u := urls.Parse .Destination -}}
{{- $src := $u.String -}}
{{- $width := 500 -}}
{{- $height := 500 -}}
{{- if not $u.IsAbs -}}
  {{- with or (.Page.Resources.Get $u.Path) (resources.Get $u.Path) -}}
    {{- $src = .RelPermalink -}}
    {{ $height = .Height}}
    {{ $width = .Width}}
  {{- else -}}
    {{- with resources.Get "images/random/0.jpg" -}}
        {{- $src = .RelPermalink -}}
        {{ $height = .Height }}
        {{ $width = .Width}}
    {{- end -}}

  {{- end -}}
{{- else -}}
    {{ if or (eq $u.Scheme "http") (eq $u.Scheme "https") }}
        {{with resources.GetRemote .Destination -}}
            {{ with .Err}}
                {{ warnf  "%s" . }}
            {{ else }}
                {{ $height = .Height }}
                {{ $width = .Width}}
            {{ end }}
        {{ else }}
            {{ warnf  "Unable to get remote resource" }}
        {{ end }}
    {{ end }}
{{- end -}}
{{- $attributes := merge .Attributes (dict "alt" .Text "src" $src "title" .Title "width" $width "height" $height ) -}}
{{/*  random_image_container.setAttribute('data-pswp-width', bufferImage.width)  */}}
{{/*  random_image_container.setAttribute('data-pswp-height', bufferImage.height)  */}}
<a class="gallery" href="{{ $src }}" data-pswp-width="{{ $width }}" data-pswp-height="{{ $height }}" aria-label="{{ .Text }}">
    <img
  {{- range $k, $v := $attributes -}}
    {{- if $v -}}
      {{- printf " %s=%q" $k $v | safeHTMLAttr -}}
    {{- end -}}
  {{- end -}}>
</a>

{{- /**/ -}}